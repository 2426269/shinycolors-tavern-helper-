# SillyTavern 调试指南

## 快速调试步骤

1. **打开 SillyTavern**
   - 在浏览器中打开 SillyTavern
   - 通常是 http://localhost:8000

2. **打开开发者工具**
   - 按 F12 键（Windows/Linux）
   - 或按 Cmd + Option + I（Mac）

3. **查看控制台**
   - 点击 "Console" 标签
   - 清空控制台（点击  图标）

4. **生成技能卡**
   - 点击 "生成技能卡" 按钮
   - 观察控制台输出

5. **关键日志**
   查找以下日志来定位问题：

    正常流程：
   -  开始生成技能卡...
   -  组装系统提示词...
   -  调用AI生成...
   -  解析AI输出...
   -  解析后的AI卡片数据: { effectEntriesLength: X, ... }
   -  验证技能卡格式...
   -  技能卡验证通过
   -  技能卡生成成功！

    如果出错：
   -  技能卡验证失败（详细错误）: [...]
   -  格式化的错误信息: [...]
   - 会显示具体哪个字段有问题

6. **查看 AI 原始输出**
   - 在控制台中展开 " 解析后的AI卡片数据" 对象
   - 检查 effectEntries 和 effectEntriesEnhanced 是否为空数组
   - 如果为空，说明 AI 没有按照词条式格式输出

7. **查看完整错误堆栈**
   - 点击控制台中的红色错误信息
   - 查看完整的错误堆栈跟踪
   - 找到具体是哪一行代码报错

## 常见问题排查

### 问题1: effectEntries 是空数组 []
**原因**: AI 没有理解词条式格式或示例卡不正确
**解决**: 
- 检查提示词中的示例卡是否包含 effectEntries
- 查看 "组装系统提示词" 日志，确认示例卡格式

### 问题2: Cannot read properties of undefined (reading 'map')
**原因**: 某个数组字段是 undefined 而不是空数组
**解决**:
- 查看 "解析后的AI卡片数据" 日志
- 检查哪个字段是 undefined
- 已添加防御性编程，应该不会再出现

### 问题3: 技能卡验证失败
**原因**: AI 输出的 JSON 格式不符合 Schema
**解决**:
- 查看 "格式化的错误信息"
- 按照错误提示修改 AI 输出

## 查看 AI 实际输出的 JSON

在控制台中输入：
`javascript
// 查看最后一次生成的原始输出
localStorage.getItem('lastAIOutput')
`

