/**
 * æç¤ºè¯åŒº
 * è´Ÿè´£ä¸ºä¸åŒAIç”Ÿæˆæ¨¡å¼æä¾›æç¤ºè¯æ¡†æ¶
 */

/**
 * æç¤ºè¯æ¨¡å¼æšä¸¾
 */
export enum PromptMode {
  /** æŠ€èƒ½å¡ç”Ÿæˆæ¨¡å¼ */
  SKILL_CARD_GENERATION = 'skill_card_generation',
}

/**
 * æç¤ºè¯å˜é‡æ¥å£ï¼ˆç”¨äºåŠ¨æ€æ›¿æ¢ï¼‰
 */
export interface PromptVariables {
  /** è§’è‰²åç§° */
  characterName?: string;
  /** å¡ç‰Œç¨€æœ‰åº¦ */
  rarity?: string;
  /** åŸ¹è‚²è®¡åˆ’ */
  producePlan?: string;
  /** æ¨èæ‰“æ³• */
  recommendedStyle?: string;
  /** ç¤ºä¾‹å¡ç‰Œåˆ—è¡¨ï¼ˆMarkdownè¡¨æ ¼ï¼‰ */
  exampleCards?: string;
  /** å¡ç‰Œä¸»é¢˜/æ¦‚å¿µ */
  theme?: string;
  /** åŸ¹è‚²è®¡åˆ’æœºåˆ¶è¯´æ˜ï¼ˆMarkdownæ ¼å¼ï¼‰ */
  producePlanMechanic?: string;
}

/**
 * æç¤ºè¯ç®¡ç†å™¨
 */
export class PromptManager {
  /**
   * æŠ€èƒ½å¡ç”Ÿæˆæç¤ºè¯æ¡†æ¶
   */
  static getSkillCardGenerationPrompt(): string {
    return `# æŠ€èƒ½å¡ç”Ÿæˆç³»ç»Ÿ

## ğŸ¯ ä½ çš„è§’è‰²
ä½ æ˜¯ã€Šå¶åƒå¤§å¸ˆ é—ªè€€è‰²å½©ã€‹çš„æŠ€èƒ½å¡è®¾è®¡å¸ˆï¼Œç²¾é€š**ç±»ã€Šå­¦å›­å¶åƒå¤§å¸ˆã€‹å¡ç‰Œæœºåˆ¶**çš„æ¸¸æˆè®¾è®¡å’Œå¹³è¡¡æ€§ã€‚æœ¬æ¸¸æˆé‡‡ç”¨å¡ç‰Œæˆ˜æ–—ç³»ç»Ÿï¼Œé€šè¿‡æŠ€èƒ½å¡ã€Pé¥®æ–™ã€Buffç³»ç»Ÿæ¥å®ç°åŸ¹è‚²å’Œæ¯”èµ›ç©æ³•ã€‚

## ğŸ“‹ ä»»åŠ¡è¯´æ˜
æ ¹æ®è§’è‰²ä¿¡æ¯å’Œç¤ºä¾‹å¡ç‰Œï¼Œä¸ºæŒ‡å®šè§’è‰²ç”Ÿæˆä¸€å¼ **ä¸“å±æŠ€èƒ½å¡**ã€‚

### å½“å‰è§’è‰²ä¿¡æ¯
- **è§’è‰²åç§°**: {{characterName}}
- **å¡ç‰Œç¨€æœ‰åº¦**: {{rarity}}
- **åŸ¹è‚²è®¡åˆ’**: {{producePlan}}
- **æ¨èæ‰“æ³•**: {{recommendedStyle}}
- **å¡ç‰Œä¸»é¢˜**: {{theme}}

## ğŸ“– æ¸¸æˆæœ¯è¯­æ ‡å‡†ç¿»è¯‘è¡¨ï¼ˆâš ï¸ å¿…é¡»ä¸¥æ ¼éµå®ˆï¼‰

#### åŸºç¡€å±æ€§
| æ—¥æ–‡ | ä¸­æ–‡ç¿»è¯‘ | è¯´æ˜ |
|------|---------|------|
| ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ | æ•°å€¼ | æŒ‡æ‰“å‡ºçš„åˆ†æ•° |
| ä½“åŠ› | ä½“åŠ› | æ¶ˆè€—èµ„æº |
| å…ƒæ°— | å…ƒæ°” | çŠ¶æ€èµ„æº |
| ã‚„ã‚‹æ°— | å¹²åŠ² | çŠ¶æ€èµ„æº |
| å¥½å°è±¡ | å¥½å°è±¡ | çŠ¶æ€èµ„æº |
| é›†ä¸­ | é›†ä¸­ | çŠ¶æ€èµ„æº |
| å…¨åŠ›å€¤ | å…¨åŠ›å€¼ | çŠ¶æ€èµ„æº |
| ã‚¹ã‚³ã‚¢ | å¾—åˆ† | æœ€ç»ˆæ¼”å‡ºå¾—åˆ† |

#### çŠ¶æ€æ•ˆæœ
| æ—¥æ–‡ | ä¸­æ–‡ç¿»è¯‘ |
|------|---------|
| å¥½èª¿ | å¥½è°ƒ |
| çµ¶å¥½èª¿ | çŠ¶æ€ç»ä½³ |
| æ¸©å­˜ | æ¸©å­˜ |
| å¼·æ°— | å¼ºæ°” |
| æ¶ˆè²»ä½“åŠ›æ¸›å°‘ | æ¶ˆè´¹ä½“åŠ›å‡å°‘ |
| æ¶ˆè²»ä½“åŠ›å‰Šæ¸› | æ¶ˆè´¹ä½“åŠ›å‰Šå‡ |

#### é€šç”¨æœ¯è¯­
| æ—¥æ–‡ | ä¸­æ–‡ç¿»è¯‘ |
|------|---------|
| ãƒ¬ãƒƒã‚¹ãƒ³ä¸­ | æ¼”å‡ºä¸­ |
| ã‚¿ãƒ¼ãƒ³ | å›åˆ |
| é‡è¤‡ä¸å¯ | ä¸å¯é‡å¤ |
| ä½¿ç”¨å¯èƒ½ | å¯é‡å¤è·å¾— |

## ğŸ¨ è®¾è®¡åŸåˆ™

### 1ï¸âƒ£ æŠ€èƒ½å¡ç±»å‹è¯´æ˜

**âš ï¸ å…³é”®åŒºåˆ«**ï¼š
- **Aå¡ï¼ˆä¸»åŠ¨/Active/ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ï¼‰**ï¼š**å¿…é¡»åŒ…å«ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿+Xï¼ˆæ•°å€¼+Xï¼‰**ï¼Œå¯ä»¥é¢å¤–é™„åŠ å…¶ä»–æ•ˆæœï¼ˆå…ƒæ°”ã€å¥½å°è±¡ç­‰ï¼‰
- **Må¡ï¼ˆç²¾ç¥/Mental/ãƒ¡ãƒ³ã‚¿ãƒ«ï¼‰**ï¼š**ä¸åŒ…å«æ•°å€¼**ï¼Œä»…æä¾›åŠ æˆæ•ˆæœï¼ˆå…ƒæ°—ã€å¥½å°è±¡ã€ã‚„ã‚‹æ°—ã€é›†ä¸­ã€å…¨åŠ›å€¤ã€å¥½èª¿ç­‰ï¼‰
- **Tå¡ï¼ˆé™·é˜±/Trapï¼‰**ï¼šæä¾›è´Ÿé¢æ•ˆæœ

### 2ï¸âƒ£ å¼ºåº¦è®¾è®¡åŸåˆ™ï¼ˆâš ï¸ æ ¸å¿ƒè¦ç‚¹ï¼‰

**å¼ºåº¦å¹³è¡¡å®Œå…¨ä¾æ®ç¤ºä¾‹å¡**ï¼š
- **å‚è€ƒåŒç¨€æœ‰åº¦ç¤ºä¾‹å¡**ï¼šå­¦ä¹ å®ƒä»¬çš„æ•ˆæœå¼ºåº¦ã€æˆæœ¬è®¾è®¡ã€æœºåˆ¶å¤æ‚åº¦
- **å‚è€ƒä½ç¨€æœ‰åº¦ç¤ºä¾‹å¡**ï¼šç¡®ä¿ä½ çš„è®¾è®¡æ˜æ˜¾æ›´å¼º
- **å‚è€ƒé«˜ç¨€æœ‰åº¦å¯¹æ¯”å¡**ï¼ˆå¦‚æœ‰ï¼‰ï¼šç¡®ä¿ä¸ä¼šè¿‡å¼ºæˆ–è¿‡å¼±
- **URå¡ç‰¹åˆ«æ³¨æ„**ï¼šå¿…é¡»åœ¨æ•°å€¼ã€æœºåˆ¶ã€ååŒæ€§ä¸‰æ–¹é¢å…¨é¢è¶…è¶Šæ‰€æœ‰SSRç¤ºä¾‹å¡

### 3ï¸âƒ£ åŸ¹è‚²è®¡åˆ’ç‰¹è‰²ä¸æ ¸å¿ƒæœºåˆ¶ï¼ˆâš ï¸ å¿…é¡»ä¸¥æ ¼éµå®ˆï¼‰

**å½“å‰åŸ¹è‚²è®¡åˆ’**ï¼š{{producePlan}}

{{producePlanMechanic}}

**âš ï¸ é‡è¦è§„åˆ™**ï¼š
- **å¿…é¡»ä¼˜å…ˆä½¿ç”¨å½“å‰åŸ¹è‚²è®¡åˆ’çš„ä¸“å±æ•ˆæœ**ï¼ˆå¦‚ï¼šæ„Ÿæ€§ç”¨å¥½è°ƒ/é›†ä¸­ï¼Œç†æ€§ç”¨å¥½å°è±¡/å¹²åŠ²ï¼Œéå‡¡ç”¨å…¨åŠ›/å¼ºæ°”/æ¸©å­˜ï¼‰
- **ç¦æ­¢æ··ç”¨å…¶ä»–è®¡åˆ’çš„æ ¸å¿ƒæ•ˆæœ**ï¼ˆå¦‚ï¼šæ„Ÿæ€§å¡ä¸èƒ½ç”¨å¥½å°è±¡/å¹²åŠ²ï¼Œç†æ€§å¡ä¸èƒ½ç”¨å¥½è°ƒ/é›†ä¸­ï¼‰
- **å¯ä»¥ä½¿ç”¨é€šç”¨æ•ˆæœ**ï¼ˆå¦‚ï¼šä½“åŠ›å›å¤ã€å…ƒæ°”å¢åŠ ã€æŠ€èƒ½å¡ä½¿ç”¨æ•°è¿½åŠ ç­‰ï¼‰
- **æ•ˆæœå¿…é¡»ç¬¦åˆè®¡åˆ’çš„ç©æ³•ç‰¹ç‚¹**ï¼ˆå¦‚ï¼šæ„Ÿæ€§=çˆ†å‘ï¼Œç†æ€§=æŒç»­ï¼Œéå‡¡=çµæ´»åˆ‡æ¢ï¼‰

### 4ï¸âƒ£ å‘½åä¸è¾“å‡ºæ ¼å¼è§„èŒƒï¼ˆâš ï¸ ä¸¥æ ¼è¦æ±‚ï¼‰

**å‘½åè§„èŒƒ**ï¼š
- **æ—¥æ–‡å**ï¼ˆnameJPï¼‰ï¼šç¬¦åˆå¶åƒå¤§å¸ˆé£æ ¼ï¼Œä¼˜é›…ä¸”å¯Œæœ‰æ„å¢ƒ
- **ä¸­æ–‡å**ï¼ˆnameCNï¼‰ï¼šå‡†ç¡®ä¼ è¾¾æŠ€èƒ½å«ä¹‰ï¼Œæ˜“äºç†è§£

**æ•ˆæœæ–‡æœ¬è§„èŒƒï¼ˆé‡è¦ï¼‰**ï¼š
- âœ… **effect å’Œ effectEnhanced å­—æ®µå¿…é¡»ä½¿ç”¨çº¯ä¸­æ–‡**
- âœ… ä½¿ç”¨æ ‡å‡†ç¿»è¯‘è¡¨ä¸­çš„æœ¯è¯­ï¼ˆæ•°å€¼ã€å…ƒæ°”ã€å¥½å°è±¡ã€å¹²åŠ²ç­‰ï¼‰
- âœ… æ•ˆæœæè¿°ç®€æ´æ˜ç¡®ï¼Œæ•°å€¼æ˜ç¡®
- âœ… æ ¼å¼ç¤ºä¾‹ï¼š"æ•°å€¼+10 å…ƒæ°”+2 ä½“åŠ›å›å¤2 â€»æ¼”å‡ºä¸­é™1æ¬¡ ä¸å¯é‡å¤"
- âŒ ç¦æ­¢ä½¿ç”¨æ—¥æ–‡ï¼ˆå¦‚ï¼šãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã€å…ƒæ°—ã€ã‚„ã‚‹æ°—ç­‰ï¼‰

**ä½¿ç”¨é™åˆ¶è¯´æ˜ï¼ˆé‡è¦ï¼‰**ï¼š
- **é‡è¤‡ä¸å¯**ï¼šå¡ç»„é‡Œåªèƒ½æœ‰ä¸€å¼ è¿™ä¸ªå¡ï¼ˆä¸å¯é‡å¤è·å¾—ï¼‰
- **ä½¿ç”¨å¯èƒ½**ï¼ˆå¯é‡å¤è·å¾—ï¼‰ï¼šå¡ç»„å¯ä»¥æœ‰å¤šä¸ªè¿™ä¸ªå¡
- **æ¼”å‡ºä¸­é™1æ¬¡**ï¼ˆãƒ¬ãƒƒã‚¹ãƒ³ä¸­1å›ï¼‰ï¼šä¸€åœºæ¼”å‡ºä¸­åªèƒ½ä½¿ç”¨ä¸€æ¬¡ï¼Œä½¿ç”¨åè¿›å…¥"é™¤å¤–"å †ï¼Œä¸‹ä¸€æ¬¡æ¼”å‡ºä¾æ—§å¯ç”¨
- **æ— æ¼”å‡ºä¸­é™åˆ¶**ï¼šå¯ä»¥å¤šæ¬¡ä½¿ç”¨ï¼Œä½¿ç”¨åè¿›å…¥"å¼ƒç‰Œå †"ï¼Œå¯ä»¥å†æ¬¡æŠ½å–ä½¿ç”¨
- **å›åˆé™åˆ¶**ï¼šå¦‚"æ­¤æ•ˆæœæœŸé—´ï¼Œæ¯å›åˆ1å›"
- âš ï¸ **ä¸è¦æ‰€æœ‰å¡éƒ½è®¾è®¡æˆ"æ¼”å‡ºä¸­é™1æ¬¡"** - æ ¹æ®ç¨€æœ‰åº¦å’Œæ•ˆæœå¼ºåº¦çµæ´»è®¾è®¡ï¼Œä½æˆæœ¬å¡å¯ä»¥æ— é™åˆ¶

**âš ï¸ é‡è¦åŒºåˆ«**ï¼š
- Aå¡æ•°é‡ â‰ˆ Må¡æ•°é‡ï¼ˆå¤§è‡´ç›¸ç­‰ï¼‰
- Aå¡ï¼šç›´æ¥å¢å¼ºæ•°å€¼ï¼ˆåˆ†æ•°ï¼‰
- Må¡ï¼šå¢å¼ºçŠ¶æ€èµ„æºï¼ˆç”¨äºè§¦å‘å…¶ä»–æ•ˆæœï¼‰


### 5ï¸âƒ£ æ•ˆæœæ–‡æœ¬æ ¼å¼è¦æ±‚
**âš ï¸ å¿…é¡»å…¨éƒ¨ä½¿ç”¨ä¸­æ–‡è¾“å‡ºï¼Œç¦æ­¢è¾“å‡ºæ—¥æ–‡ï¼**

- âœ… æ­£ç¡®ç¤ºä¾‹ï¼š"æ•°å€¼+10 å…ƒæ°”+3 ä½“åŠ›å›å¤2 â€»æ¼”å‡ºä¸­é™1æ¬¡ ä¸å¯é‡å¤"
- âŒ é”™è¯¯ç¤ºä¾‹ï¼š"ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿+10 å…ƒæ°—+3 ä½“åŠ›å›å¾©2 â€»ãƒ¬ãƒƒã‚¹ãƒ³ä¸­1å› é‡è¤‡ä¸å¯"
- æ•ˆæœæè¿°ç®€æ´æ˜ç¡®
- æ•°å€¼æ˜ç¡®ï¼Œé¿å…æ¨¡ç³Šè¡¨è¿°
- ä½¿ç”¨ä¸Šè¿°æ ‡å‡†æœ¯è¯­ç¿»è¯‘è¡¨

## ğŸ“š ç¤ºä¾‹å¡ç‰Œä¸å¼ºåº¦ç³»ç»Ÿ

### ç¤ºä¾‹å¡çš„ä½œç”¨è¯´æ˜
ç³»ç»Ÿå·²æ ¹æ®ä½ è¦ç”Ÿæˆçš„å¡ç‰Œï¼ˆ**{{rarity}}çº§ - {{producePlan}}**ï¼‰æ™ºèƒ½æŠ½å–äº†ä»¥ä¸‹ç¤ºä¾‹å¡ï¼š

**ğŸ“Š æŠ½å–ç­–ç•¥**ï¼š
- **ä¸»ç¤ºä¾‹å¡ï¼ˆ{{rarity}}çº§ï¼‰**ï¼šæä¾›è®¾è®¡å‚è€ƒï¼Œå­¦ä¹ å‘½åé£æ ¼ã€æ•ˆæœæ ¼å¼ã€æœºåˆ¶è®¾è®¡
- **å‚è€ƒå¡ï¼ˆä½ç¨€æœ‰åº¦ï¼‰**ï¼šæé†’å¼ºåº¦ä¸‹é™ï¼Œä½ çš„è®¾è®¡å¿…é¡»æ˜æ˜¾å¼ºäºè¿™äº›å¡
- **å¯¹æ¯”å¡ï¼ˆé«˜ç¨€æœ‰åº¦ï¼‰**ï¼šæé†’å¼ºåº¦ä¸Šé™ï¼Œä½ çš„è®¾è®¡ä¸èƒ½è¶…è¿‡è¿™äº›å¡å¤ªå¤š

**âš ï¸ URçº§ç‰¹æ®Šè§„åˆ™**ï¼š
å¦‚æœä½ è¦ç”Ÿæˆçš„æ˜¯URå¡ï¼Œä¸‹æ–¹å°†æä¾›10å¼ SSRå¡ä½œä¸ºå‚è€ƒã€‚**ä½ å¿…é¡»åœ¨æ‰€æœ‰æ–¹é¢è¶…è¶Šè¿™äº›SSRå¡**ï¼š
- æ›´é«˜çš„æ•ˆæœæ•°å€¼ï¼ˆè‡³å°‘æå‡30-50%ï¼‰
- æ›´ç‹¬ç‰¹çš„æœºåˆ¶ï¼ˆSSRæ²¡æœ‰çš„ç‰¹æ®Šæ•ˆæœï¼‰ä¸å¯åŸåˆ›æœºåˆ¶ï¼Œä»ä½¿ç”¨ç°æœ‰çš„æœºåˆ¶
- æ›´å¼ºçš„åŸ¹è‚²è®¡åˆ’ååŒæ€§ï¼ˆä¸è®¡åˆ’æ·±åº¦ç»‘å®šçš„å¢ç›Šï¼‰

---

{{exampleCards}}

---

## âš ï¸ é‡è¦é™åˆ¶
âŒ **ç¦æ­¢äº‹é¡¹**:
- ç¦æ­¢ç›´æ¥å¢åŠ  V/D/V å±æ€§ï¼ˆåªèƒ½é€šè¿‡Buffé—´æ¥æå‡ï¼‰
- ç¦æ­¢è¶…å‡ºç¨€æœ‰åº¦å¯¹åº”çš„æˆæœ¬/æ•ˆæœèŒƒå›´
- ç¦æ­¢ä½¿ç”¨ä¸ç¬¦åˆä¸–ç•Œè§‚çš„å‘½å

âœ… **å¿…é¡»åŒ…å«**:
- æ—¥æ–‡å’Œä¸­æ–‡å‘½åï¼ˆnameJPå’ŒnameCNå­—æ®µï¼‰
- æ˜ç¡®çš„æˆæœ¬å’Œç¨€æœ‰åº¦
- **å¼ºåŒ–å‰åä¸¤å¥—å®Œæ•´çš„è¯æ¡å¼æ•ˆæœ**ï¼ˆeffectEntrieså’ŒeffectEntriesEnhancedæ•°ç»„ï¼Œæ¯ä¸ªæ•°ç»„è‡³å°‘åŒ…å«1ä¸ªæ•ˆæœè¯æ¡ï¼‰
- æ‰€æœ‰effectå­—æ®µå¿…é¡»ä½¿ç”¨çº¯ä¸­æ–‡
- ç¬¦åˆåŸ¹è‚²è®¡åˆ’ç‰¹è‰²çš„ç‹¬ç‰¹æ•ˆæœ

âš ï¸ **ä¸¥æ ¼ç¦æ­¢ä½¿ç”¨æ—§æ ¼å¼**ï¼š
- âŒ ä¸è¦ä½¿ç”¨ "effect": "æ–‡æœ¬" æˆ– "effectEnhanced": "æ–‡æœ¬"
- âœ… å¿…é¡»ä½¿ç”¨ "effectEntries": [{icon, effect, isConsumption}, ...] æ•°ç»„æ ¼å¼
- âœ… å¿…é¡»ä½¿ç”¨ "effectEntriesEnhanced": [{icon, effect, isConsumption}, ...] æ•°ç»„æ ¼å¼

## ğŸ“¤ è¾“å‡ºæ ¼å¼ï¼ˆâš ï¸ è¯æ¡å¼æ ¼å¼ï¼‰

**âš ï¸ ä»…è¾“å‡ºä»¥ä¸‹JSONæ ¼å¼ï¼Œä¸è¦åŒ…å«ä»»ä½•è§£é‡Šæ–‡å­—ï¼**

### æ ¼å¼è¯´æ˜ï¼šä½¿ç”¨è¯æ¡å¼æ•ˆæœæ•°ç»„

æŠ€èƒ½å¡çš„æ•ˆæœå¿…é¡»ä»¥**è¯æ¡æ•°ç»„**å½¢å¼è¾“å‡ºï¼Œæ¯ä¸ªæ•ˆæœå•ç‹¬ä¸€ä¸ªè¯æ¡å¯¹è±¡ã€‚

#### æ•ˆæœè¯æ¡å¯¹è±¡å­—æ®µè¯´æ˜ï¼š
- **icon** (å¿…å¡«): å›¾æ ‡URLï¼Œæ ¹æ®æ•ˆæœç±»å‹è‡ªåŠ¨åŒ¹é…ï¼š
  - æ•°å€¼: \`https://raw.githubusercontent.com/2426269/shinycolors-assets-cdn/main/æ¸¸æˆå›¾æ ‡/æ•°å€¼.png\`
  - ä½“åŠ›: \`https://raw.githubusercontent.com/2426269/shinycolors-assets-cdn/main/æ¸¸æˆå›¾æ ‡/ä½“åŠ›.png\`
  - å…ƒæ°”: \`https://raw.githubusercontent.com/2426269/shinycolors-assets-cdn/main/æ¸¸æˆå›¾æ ‡/å…ƒæ°”.png\`
  - å¥½å°è±¡: \`https://raw.githubusercontent.com/2426269/shinycolors-assets-cdn/main/æ¸¸æˆå›¾æ ‡/å¥½å°è±¡.png\`
  - å¹²åŠ²: \`https://raw.githubusercontent.com/2426269/shinycolors-assets-cdn/main/æ¸¸æˆå›¾æ ‡/å¹²åŠ².png\`
  - é›†ä¸­: \`https://raw.githubusercontent.com/2426269/shinycolors-assets-cdn/main/æ¸¸æˆå›¾æ ‡/é›†ä¸­.png\`
  - å…¨åŠ›å€¼: \`https://raw.githubusercontent.com/2426269/shinycolors-assets-cdn/main/æ¸¸æˆå›¾æ ‡/å…¨åŠ›å€¼.png\`
  - å¥½è°ƒ: \`https://raw.githubusercontent.com/2426269/shinycolors-assets-cdn/main/æ¸¸æˆå›¾æ ‡/å¥½è°ƒ.png\`
  - çŠ¶æ€ç»ä½³: \`https://raw.githubusercontent.com/2426269/shinycolors-assets-cdn/main/æ¸¸æˆå›¾æ ‡/ç»å¥½è°ƒ.png\`
  - å¼ºæ°”: \`https://raw.githubusercontent.com/2426269/shinycolors-assets-cdn/main/æ¸¸æˆå›¾æ ‡/å¼ºæ°”.png\`
  - æ¸©å­˜: \`https://raw.githubusercontent.com/2426269/shinycolors-assets-cdn/main/æ¸¸æˆå›¾æ ‡/æ¸©å­˜.png\`
  - æ¶ˆè´¹ä½“åŠ›å‡å°‘: \`https://raw.githubusercontent.com/2426269/shinycolors-assets-cdn/main/æ¸¸æˆå›¾æ ‡/æ¶ˆè´¹ä½“åŠ›å‡å°‘.png\`
  - æ¡ä»¶æˆ–å…¶ä»–æ— å›¾æ ‡æ•ˆæœ: \`""\`ï¼ˆç©ºå­—ç¬¦ä¸²ï¼‰

- **effect** (å¿…å¡«): æ•ˆæœæè¿°æ–‡æœ¬ï¼Œå¿…é¡»ä½¿ç”¨çº¯ä¸­æ–‡ï¼Œä¾‹å¦‚ï¼š
  - "æ•°å€¼+10"
  - "å…ƒæ°”+3"
  - "å˜æ›´ä¸ºå¼ºæ°”2æ®µ"
  - "ä¸‹å›åˆï¼Œå˜æ›´ä¸ºæ¸©å­˜"
  - "æ¶ˆè´¹ä½“åŠ›å‡å°‘2å›åˆ"
  - "å…¨åŠ›æ—¶"ï¼ˆæ¡ä»¶ï¼‰

- **isConsumption** (å¿…å¡«): æ˜¯å¦ä¸ºæ¶ˆè€—å‹æ•ˆæœï¼Œtrueæˆ–false

#### å®Œæ•´JSONæ ¼å¼å­—æ®µè¯´æ˜ï¼š
- **id**: è§’è‰²è‹±æ–‡å_ç¨€æœ‰åº¦å°å†™_exclusive
- **nameJP**: æ—¥æ–‡æŠ€èƒ½å
- **nameCN**: ä¸­æ–‡æŠ€èƒ½å
- **type**: "ä¸»åŠ¨"æˆ–"ç²¾ç¥"
- **rarity**: "N"æˆ–"R"æˆ–"SR"æˆ–"SSR"æˆ–"UR"
- **cost**: å­—ç¬¦ä¸²ï¼ˆå¦‚ï¼š"ä½“åŠ›æ¶ˆè€—2"ã€"å…ƒæ°”æ¶ˆè€—3"ã€"æ— æ¶ˆè€—"ï¼‰
- **producePlan**: "æ„Ÿæ€§"æˆ–"ç†æ€§"æˆ–"éå‡¡"æˆ–"è‡ªç”±"
- **effectEntries**: æ•ˆæœè¯æ¡æ•°ç»„ï¼ˆå¼ºåŒ–å‰ï¼‰
- **effectEntriesEnhanced**: æ•ˆæœè¯æ¡æ•°ç»„ï¼ˆå¼ºåŒ–åï¼‰
- **conditionalEffects**: æ¡ä»¶æ•ˆæœæ•°ç»„ï¼ˆå¯é€‰ï¼Œå¼ºåŒ–å‰ï¼‰
- **conditionalEffectsEnhanced**: æ¡ä»¶æ•ˆæœæ•°ç»„ï¼ˆå¯é€‰ï¼Œå¼ºåŒ–åï¼‰
- **restrictions**: é™åˆ¶ä¿¡æ¯å¯¹è±¡
  - **isDuplicatable**: trueï¼ˆå¯é‡å¤è·å¾—ï¼‰æˆ–falseï¼ˆä¸å¯é‡å¤ï¼‰
  - **usesPerBattle**: 1ï¼ˆæ¼”å‡ºä¸­é™1æ¬¡ï¼‰æˆ–nullï¼ˆæ— é™åˆ¶ï¼‰
- **flavor**: é£å‘³æ–‡æœ¬ï¼ˆå¯é€‰ï¼‰
- **isExclusive**: true
- **exclusiveCharacter**: è§’è‰²å

âš ï¸ **é‡è¦**ï¼š
1. æ‰€æœ‰ effect å­—æ®µå¿…é¡»ä½¿ç”¨çº¯ä¸­æ–‡
2. ä¸è¦æ·»åŠ JSONæ³¨é‡Šï¼Œä¸è¦ä½¿ç”¨ | ç¬¦å·
3. icon å­—æ®µæ ¹æ®æ•ˆæœç±»å‹å¡«å…¥å®Œæ•´URL
4. æ•°å€¼ç›´æ¥å†™åœ¨ effect æ–‡æœ¬ä¸­ï¼ˆå¦‚"æ•°å€¼+10"ï¼‰
5. æ¡ä»¶ç±»è¯æ¡ï¼ˆå¦‚"å…¨åŠ›æ—¶"ï¼‰iconè®¾ä¸ºç©ºå­—ç¬¦ä¸²""

### ğŸ“ è¾“å‡ºç¤ºä¾‹ï¼ˆå®Œæ•´æœ‰æ•ˆçš„JSONæ ¼å¼ï¼‰

**ç¤ºä¾‹1ï¼šç†æ€§è®¡åˆ’SSRå¡**
\`\`\`json
{
  "id": "mayuzumi_fuyuko_ssr_exclusive",
  "nameJP": "ã‚­ãƒ©ã‚­ãƒ©ãºãƒ¼ãƒ‘ãƒ¼",
  "nameCN": "é—ªé—ªçº¸ç‰‡",
  "type": "ä¸»åŠ¨",
  "rarity": "SSR",
  "cost": "æ— æ¶ˆè€—",
  "producePlan": "ç†æ€§",
  "effectEntries": [
    {
      "icon": "https://raw.githubusercontent.com/2426269/shinycolors-assets-cdn/main/æ¸¸æˆå›¾æ ‡/å¹²åŠ².png",
      "effect": "å¹²åŠ²-3",
      "isConsumption": true
    },
    {
      "icon": "https://raw.githubusercontent.com/2426269/shinycolors-assets-cdn/main/æ¸¸æˆå›¾æ ‡/æ•°å€¼.png",
      "effect": "æ•°å€¼+å…ƒæ°”çš„110%",
      "isConsumption": false
    },
    {
      "icon": "",
      "effect": "æŠ½å–1å¼ æŠ€èƒ½å¡",
      "isConsumption": false
    }
  ],
  "effectEntriesEnhanced": [
    {
      "icon": "https://raw.githubusercontent.com/2426269/shinycolors-assets-cdn/main/æ¸¸æˆå›¾æ ‡/å¹²åŠ².png",
      "effect": "å¹²åŠ²-3",
      "isConsumption": true
    },
    {
      "icon": "https://raw.githubusercontent.com/2426269/shinycolors-assets-cdn/main/æ¸¸æˆå›¾æ ‡/æ•°å€¼.png",
      "effect": "æ•°å€¼+å…ƒæ°”çš„150%",
      "isConsumption": false
    },
    {
      "icon": "",
      "effect": "æŠ½å–2å¼ æŠ€èƒ½å¡",
      "isConsumption": false
    }
  ],
  "restrictions": {
    "isDuplicatable": false,
    "usesPerBattle": null
  },
  "flavor": "åœ¨è®­ç»ƒä¸­é—ªçƒçš„åˆ›æ„ï¼ŒåŒ–ä¸ºèˆå°ä¸Šçš„å…‰èŠ’ã€‚",
  "isExclusive": true,
  "exclusiveCharacter": "é»›å†¬å„ªå­"
}
\`\`\`

**ç¤ºä¾‹2ï¼šæ„Ÿæ€§è®¡åˆ’SSRå¡ï¼ˆå«æ¡ä»¶æ•ˆæœï¼‰**
\`\`\`json
{
  "id": "nanakusa_nichika_ssr_exclusive",
  "nameJP": "ã»ãã‚Œã‚‹ã²ã¨ã¨ã",
  "nameCN": "èˆ’ç¼“æ—¶åˆ»",
  "type": "ç²¾ç¥",
  "rarity": "SSR",
  "cost": "æ— æ¶ˆè€—",
  "producePlan": "æ„Ÿæ€§",
  "effectEntries": [
    {
      "icon": "https://raw.githubusercontent.com/2426269/shinycolors-assets-cdn/main/æ¸¸æˆå›¾æ ‡/å¥½è°ƒ.png",
      "effect": "å¥½è°ƒ-1",
      "isConsumption": true
    },
    {
      "icon": "",
      "effect": "é›†ä¸­å¢åŠ é‡+50%ï¼ˆ3å›åˆï¼‰",
      "isConsumption": false
    }
  ],
  "conditionalEffects": [
    {
      "icon": "",
      "condition": "å¥½è°ƒçŠ¶æ€æ—¶",
      "effect": "é›†ä¸­+4",
      "isConsumption": false
    }
  ],
  "effectEntriesEnhanced": [
    {
      "icon": "https://raw.githubusercontent.com/2426269/shinycolors-assets-cdn/main/æ¸¸æˆå›¾æ ‡/å¥½è°ƒ.png",
      "effect": "å¥½è°ƒ-1",
      "isConsumption": true
    },
    {
      "icon": "",
      "effect": "é›†ä¸­å¢åŠ é‡+75%ï¼ˆ3å›åˆï¼‰",
      "isConsumption": false
    }
  ],
  "conditionalEffectsEnhanced": [
    {
      "icon": "https://raw.githubusercontent.com/2426269/shinycolors-assets-cdn/main/æ¸¸æˆå›¾æ ‡/é›†ä¸­.png",
      "condition": "å¥½è°ƒçŠ¶æ€æ—¶",
      "effect": "é›†ä¸­+6",
      "isConsumption": false
    }
  ],
  "restrictions": {
    "isDuplicatable": false,
    "usesPerBattle": 1
  },
  "flavor": "èˆ’ç¼“èº«å¿ƒï¼Œæ¿€å‘æ½œèƒ½çš„æ¸©æŸ”æ—¶å…‰ã€‚",
  "isExclusive": true,
  "exclusiveCharacter": "ä¸ƒè‰ã«ã¡ã‹"
}
\`\`\`

**âš ï¸ æœ€ç»ˆæ£€æŸ¥æ¸…å•ï¼ˆç”Ÿæˆå‰å¿…é¡»ç¡®è®¤ï¼‰**ï¼š
1. âœ… effectEntries æ•°ç»„å¿…é¡»åŒ…å«è‡³å°‘1ä¸ªæ•ˆæœè¯æ¡ï¼ˆä¸èƒ½æ˜¯ç©ºæ•°ç»„[]ï¼‰
2. âœ… effectEntriesEnhanced æ•°ç»„å¿…é¡»åŒ…å«è‡³å°‘1ä¸ªæ•ˆæœè¯æ¡ï¼ˆä¸èƒ½æ˜¯ç©ºæ•°ç»„[]ï¼‰
3. âœ… æ¯ä¸ªè¯æ¡å¯¹è±¡å¿…é¡»åŒ…å«3ä¸ªå­—æ®µï¼šiconï¼ˆå­—ç¬¦ä¸²ï¼‰ã€effectï¼ˆå­—ç¬¦ä¸²ï¼‰ã€isConsumptionï¼ˆå¸ƒå°”å€¼ï¼‰
4. âœ… æ‰€æœ‰ effect å­—æ®µçš„æ–‡æœ¬å¿…é¡»ä½¿ç”¨çº¯ä¸­æ–‡ï¼ˆç¦æ­¢æ—¥æ–‡ï¼šãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã€å…ƒæ°—ã€ã‚„ã‚‹æ°—ç­‰ï¼‰
5. âœ… ä½¿ç”¨æ ‡å‡†æœ¯è¯­ç¿»è¯‘è¡¨ä¸­çš„æœ¯è¯­ï¼ˆæ•°å€¼ã€å…ƒæ°”ã€å¥½å°è±¡ã€å¹²åŠ²ã€é›†ä¸­ã€å…¨åŠ›å€¼ç­‰ï¼‰
6. âœ… æ¶ˆè€—å‹æ•ˆæœï¼ˆå¦‚"å¹²åŠ²-3"ï¼‰å¿…é¡»æ ‡è®° isConsumption: true
7. âœ… icon å­—æ®µå¿…é¡»å¡«å…¥å®Œæ•´çš„GitHubå›¾æ ‡URLæˆ–ç©ºå­—ç¬¦ä¸²""ï¼ˆä¸èƒ½çœç•¥æ­¤å­—æ®µï¼‰
8. âœ… restrictions å¯¹è±¡å¿…é¡»åŒ…å« isDuplicatable å’Œ usesPerBattle ä¸¤ä¸ªå­—æ®µ

## ğŸ¯ å¼€å§‹ç”Ÿæˆ
è¯·åŸºäºä»¥ä¸Šä¿¡æ¯å’Œ**è¯æ¡å¼æ ¼å¼è¦æ±‚**ï¼Œä¸º **{{characterName}}** ç”Ÿæˆä¸€å¼  **{{rarity}}** ç¨€æœ‰åº¦çš„ä¸“å±æŠ€èƒ½å¡ã€‚

**å†æ¬¡å¼ºè°ƒ**ï¼šeffectEntries å’Œ effectEntriesEnhanced æ•°ç»„ç»å¯¹ä¸èƒ½ä¸ºç©ºï¼Œå¿…é¡»åŒ…å«å…·ä½“çš„æ•ˆæœè¯æ¡ï¼
`;
  }

  /**
   * æ›¿æ¢æç¤ºè¯ä¸­çš„å˜é‡
   * @param template æç¤ºè¯æ¨¡æ¿
   * @param variables å˜é‡å¯¹è±¡
   * @returns æ›¿æ¢åçš„æç¤ºè¯
   */
  static replaceVariables(template: string, variables: PromptVariables): string {
    let result = template;

    // æ›¿æ¢æ‰€æœ‰å˜é‡
    Object.entries(variables).forEach(([key, value]) => {
      const placeholder = `{{${key}}}`;
      result = result.replaceAll(placeholder, value || '');
    });

    // æ¸…ç†æœªæ›¿æ¢çš„å ä½ç¬¦ï¼ˆæ›¿æ¢ä¸ºç©ºæˆ–é»˜è®¤å€¼ï¼‰
    result = result.replace(/\{\{[^}]+\}\}/g, 'ï¼ˆæœªæŒ‡å®šï¼‰');

    return result;
  }

  /**
   * è·å–æŒ‡å®šæ¨¡å¼çš„æç¤ºè¯ï¼ˆä¼˜å…ˆä½¿ç”¨è‡ªå®šä¹‰æ ¼å¼ï¼‰
   * @param mode æç¤ºè¯æ¨¡å¼
   * @param variables å˜é‡å¯¹è±¡ï¼ˆå¯é€‰ï¼‰
   * @returns æç¤ºè¯å†…å®¹
   */
  static getPrompt(mode: PromptMode, variables?: PromptVariables): string {
    // å…ˆå°è¯•ä»å…¨å±€å˜é‡è¯»å–è‡ªå®šä¹‰æ ¼å¼
    try {
      const globalVars = getVariables({ type: 'global' });
      const customPromptKey = `prompt_template_${mode}`;
      if (typeof globalVars[customPromptKey] === 'string' && globalVars[customPromptKey].trim()) {
        console.log(`âœ… ä½¿ç”¨è‡ªå®šä¹‰æç¤ºè¯æ¨¡æ¿: ${mode}`);
        const template = globalVars[customPromptKey];
        return variables ? this.replaceVariables(template, variables) : template;
      }
    } catch (error) {
      console.warn('âš ï¸ è¯»å–è‡ªå®šä¹‰æç¤ºè¯æ¨¡æ¿å¤±è´¥ï¼Œä½¿ç”¨é»˜è®¤æ ¼å¼:', error);
    }

    // å¦‚æœæ²¡æœ‰è‡ªå®šä¹‰æ ¼å¼ï¼Œä½¿ç”¨é»˜è®¤æ ¼å¼
    let template = '';
    switch (mode) {
      case PromptMode.SKILL_CARD_GENERATION:
        template = this.getSkillCardGenerationPrompt();
        break;
      default:
        console.error(`âŒ æœªçŸ¥çš„æç¤ºè¯æ¨¡å¼: ${mode}`);
        return '';
    }

    return variables ? this.replaceVariables(template, variables) : template;
  }

  /**
   * è·å–æŒ‡å®šæ¨¡å¼çš„é»˜è®¤æç¤ºè¯æ¨¡æ¿ï¼ˆç”¨äºæ˜¾ç¤ºå’Œæ¢å¤ï¼‰
   */
  static getDefaultPrompt(mode: PromptMode): string {
    switch (mode) {
      case PromptMode.SKILL_CARD_GENERATION:
        return this.getSkillCardGenerationPrompt();
      default:
        return '';
    }
  }

  /**
   * è·å–æ¨¡å¼å¯¹åº”çš„åç§°
   */
  private static getModeName(mode: PromptMode): string {
    const modeNames: Record<PromptMode, string> = {
      [PromptMode.SKILL_CARD_GENERATION]: 'æŠ€èƒ½å¡ç”Ÿæˆæç¤ºè¯',
    };
    return modeNames[mode] || 'æœªçŸ¥æ¨¡å¼æç¤ºè¯';
  }

  /**
   * æç¤ºè¯æ¡†æ¶çš„å›ºå®šUID
   */
  private static readonly PROMPT_UID = 999999998; // ä½¿ç”¨å›ºå®šçš„å¤§æ•°å­—ä½œä¸ºUID

  /**
   * å°†æç¤ºè¯æ¡†æ¶æ·»åŠ åˆ°/æ›´æ–°åˆ°ä¸–ç•Œä¹¦
   * @param worldbookName ä¸–ç•Œä¹¦åç§°
   * @param mode æç¤ºè¯æ¨¡å¼
   * @param variables å˜é‡å¯¹è±¡ï¼ˆå¯é€‰ï¼Œå¦‚æœæä¾›åˆ™å¡«å……åå†æ·»åŠ ï¼‰
   * @returns Promise<void>
   */
  static async addPromptToWorldbook(
    worldbookName: string,
    mode: PromptMode,
    variables?: PromptVariables,
  ): Promise<void> {
    const promptContent = this.getPrompt(mode, variables);
    const modeName = this.getModeName(mode);

    // ç¡®ä¿ä¸–ç•Œä¹¦å­˜åœ¨
    const worldbooks = getWorldbookNames();
    if (!worldbooks.includes(worldbookName)) {
      console.log(`ğŸ“š åˆ›å»ºæ–°ä¸–ç•Œä¹¦: ${worldbookName}`);
      createWorldbook(worldbookName);
    }

    // è·å–ä¸–ç•Œä¹¦å†…å®¹
    const worldbook = await getWorldbook(worldbookName);

    // æ£€æŸ¥æ¡ç›®æ˜¯å¦å·²å­˜åœ¨
    const entryIndex = worldbook.findIndex(entry => entry.uid === this.PROMPT_UID);

    const entry = {
      name: `æç¤ºè¯æ¡†æ¶ï¼ˆå½“å‰æ¨¡å¼: ${modeName}ï¼‰`,
      content: promptContent,
      uid: this.PROMPT_UID,
      enabled: true,
      strategy: {
        type: 'constant' as const,
        keys: [],
        keys_secondary: {
          logic: 'and_any' as const,
          keys: [],
        },
        scan_depth: 'same_as_global' as const,
      },
      position: {
        type: 'at_depth' as const,
        role: 'system' as const,
        depth: 0,
        order: 200,
      },
      probability: 100,
      recursion: {
        prevent_incoming: true,
        prevent_outgoing: true,
        delay_until: null,
      },
      effect: {
        sticky: null,
        cooldown: null,
        delay: null,
      },
      extra: {
        entry_type: 'prompt_framework',
        mode: mode,
        current_mode: modeName,
      },
    };

    if (entryIndex !== -1) {
      // æ›´æ–°ç°æœ‰æ¡ç›®
      worldbook[entryIndex] = entry;
      console.log(`ğŸ”„ æ›´æ–°æç¤ºè¯æ¡†æ¶å†…å®¹: ${modeName}`);
    } else {
      // æ·»åŠ æ–°æ¡ç›®
      worldbook.push(entry);
      console.log(`âœ¨ åˆ›å»ºæç¤ºè¯æ¡†æ¶æ¡ç›®: ${modeName}`);
    }

    replaceWorldbook(worldbookName, worldbook);
  }

  /**
   * åˆå§‹åŒ–æç¤ºè¯æ¡†æ¶åˆ°ä¸–ç•Œä¹¦ï¼ˆä½¿ç”¨æŠ€èƒ½å¡ç”Ÿæˆæ¨¡å¼ï¼‰
   * @param worldbookName ä¸–ç•Œä¹¦åç§°
   * @returns Promise<void>
   */
  static async initializePromptToWorldbook(worldbookName: string): Promise<void> {
    await this.addPromptToWorldbook(worldbookName, PromptMode.SKILL_CARD_GENERATION);
    console.log(`ğŸ‰ æç¤ºè¯æ¡†æ¶å·²åˆå§‹åŒ–åˆ°ä¸–ç•Œä¹¦: ${worldbookName}`);
  }

  /**
   * ä»ä¸–ç•Œä¹¦ä¸­ç§»é™¤æç¤ºè¯æ¡†æ¶
   * @param worldbookName ä¸–ç•Œä¹¦åç§°
   * @returns Promise<void>
   */
  static async removePromptFromWorldbook(worldbookName: string): Promise<void> {
    const worldbook = await getWorldbook(worldbookName);
    const entryIndex = worldbook.findIndex(entry => entry.uid === this.PROMPT_UID);

    if (entryIndex !== -1) {
      worldbook.splice(entryIndex, 1);
      replaceWorldbook(worldbookName, worldbook);
      console.log('ğŸ—‘ï¸ å·²ä»ä¸–ç•Œä¹¦ç§»é™¤æç¤ºè¯æ¡†æ¶');
    }
  }

  /**
   * æ£€æŸ¥æç¤ºè¯æ¡†æ¶æ˜¯å¦å­˜åœ¨
   * @param worldbookName ä¸–ç•Œä¹¦åç§°
   * @returns boolean
   */
  static async promptExistsInWorldbook(worldbookName: string): Promise<boolean> {
    const worldbook = await getWorldbook(worldbookName);
    return worldbook.some(entry => entry.uid === this.PROMPT_UID);
  }
}
