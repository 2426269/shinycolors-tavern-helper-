<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>æˆ˜æ–—Demoæµ‹è¯•</title>
    <style>
      body {
        font-family: 'Segoe UI', sans-serif;
        background: #1a1a2e;
        color: #fff;
        padding: 20px;
      }
      h1 {
        text-align: center;
        color: #ffd700;
      }
      .container {
        max-width: 800px;
        margin: 0 auto;
      }
      .log {
        background: #000;
        padding: 15px;
        border-radius: 8px;
        font-family: monospace;
        white-space: pre-wrap;
        max-height: 400px;
        overflow-y: auto;
      }
      button {
        padding: 10px 20px;
        margin: 5px;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-size: 14px;
      }
      .btn-primary {
        background: #3b82f6;
        color: #fff;
      }
      .btn-secondary {
        background: #4b5563;
        color: #fff;
      }
      .hand {
        display: flex;
        gap: 10px;
        margin: 20px 0;
        flex-wrap: wrap;
      }
      .card {
        padding: 10px;
        background: #2d2d44;
        border-radius: 8px;
        border: 2px solid #666;
        cursor: pointer;
        width: 120px;
      }
      .card:hover {
        border-color: #ffd700;
      }
      .card.R {
        border-color: #9ca3af;
      }
      .card.SR {
        border-color: #fbbf24;
      }
      .card.SSR {
        border-color: #a78bfa;
      }
      .stats {
        display: flex;
        gap: 20px;
        margin: 20px 0;
      }
      .stat {
        padding: 10px;
        background: #374151;
        border-radius: 8px;
      }
      .stat-label {
        font-size: 12px;
        color: #aaa;
      }
      .stat-value {
        font-size: 24px;
        font-weight: bold;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>ğŸ® æˆ˜æ–—Demoæµ‹è¯•</h1>

      <div class="stats" id="stats">åŠ è½½ä¸­...</div>

      <div>
        <h3>æ‰‹ç‰Œ</h3>
        <div class="hand" id="hand"></div>
      </div>

      <div>
        <button class="btn-secondary" onclick="skipTurn()">è·³è¿‡ (+2ä½“åŠ›)</button>
        <button class="btn-primary" onclick="endTurn()">ç»“æŸå›åˆ</button>
        <button class="btn-secondary" onclick="startBattle()">é‡æ–°å¼€å§‹</button>
      </div>

      <h3>æˆ˜æ–—æ—¥å¿—</h3>
      <div class="log" id="log"></div>
    </div>

    <script type="module">
      // ç”±äºè¿™æ˜¯ç‹¬ç«‹HTMLï¼Œæˆ‘ä»¬éœ€è¦å¯¼å…¥ç¼–è¯‘åçš„æ¨¡å—
      // è¯·åœ¨æµè§ˆå™¨æ§åˆ¶å°è¿è¡Œä»¥ä¸‹æµ‹è¯•ä»£ç ï¼š

      const logEl = document.getElementById('log');
      const handEl = document.getElementById('hand');
      const statsEl = document.getElementById('stats');

      // è¦†ç›– console.log æ¥æ˜¾ç¤ºæ—¥å¿—
      const originalLog = console.log;
      console.log = (...args) => {
        originalLog(...args);
        logEl.textContent += args.join(' ') + '\n';
        logEl.scrollTop = logEl.scrollHeight;
      };

      // æ¨¡æ‹Ÿæˆ˜æ–—çŠ¶æ€
      let state = {
        turn: 1,
        maxTurns: 12,
        score: 0,
        targetScore: 100,
        genki: 0,
        stamina: 50,
        maxStamina: 50,
        concentration: 0,
        goodImpression: 0,
        cardsUsedThisTurn: 0,
        maxCardsPerTurn: 1,
        hand: [],
      };

      // æµ‹è¯•å¡ç‰Œ
      const demoCards = [
        { id: 1, name: 'è¡¨ç¾ã®åŸºæœ¬', rarity: 'R', cost: -2, effect: 'å¾—åˆ†+8' },
        { id: 2, name: 'æ°—æŒã¡ã®æº–å‚™', rarity: 'R', cost: -3, effect: 'é›†ä¸­+3' },
        { id: 3, name: 'ãƒã‚¸ãƒ†ã‚£ãƒ–ã‚·ãƒ³ã‚­ãƒ³ã‚°', rarity: 'SR', cost: -4, effect: 'å¥½è°ƒ+3å›åˆ' },
        { id: 4, name: 'æ·±å‘¼å¸', rarity: 'R', cost: -2, effect: 'å…ƒæ°”+5' },
        { id: 5, name: 'å¹¸ã›ãªæ™‚é–“', rarity: 'SR', cost: -5, effect: 'å¥½å°è±¡+6' },
      ];

      function renderStats() {
        statsEl.innerHTML = `
        <div class="stat">
          <div class="stat-label">å›åˆ</div>
          <div class="stat-value">${state.turn}/${state.maxTurns}</div>
        </div>
        <div class="stat">
          <div class="stat-label">å¾—åˆ†</div>
          <div class="stat-value" style="color: #ffd700">${state.score}/${state.targetScore}</div>
        </div>
        <div class="stat">
          <div class="stat-label">å…ƒæ°”</div>
          <div class="stat-value" style="color: #4ade80">${state.genki}</div>
        </div>
        <div class="stat">
          <div class="stat-label">ä½“åŠ›</div>
          <div class="stat-value" style="color: #f87171">${state.stamina}/${state.maxStamina}</div>
        </div>
        <div class="stat">
          <div class="stat-label">é›†ä¸­</div>
          <div class="stat-value" style="color: #c4b5fd">${state.concentration}</div>
        </div>
        <div class="stat">
          <div class="stat-label">å¥½å°è±¡</div>
          <div class="stat-value" style="color: #fbbf24">${state.goodImpression}</div>
        </div>
      `;
      }

      function renderHand() {
        handEl.innerHTML = state.hand
          .map(
            (card, i) => `
        <div class="card ${card.rarity}" onclick="useCard(${i})">
          <div style="font-size: 10px; color: #888">${card.rarity}</div>
          <div style="font-weight: bold">${card.name}</div>
          <div style="font-size: 11px; color: #4ade80">Cost: ${card.cost}</div>
          <div style="font-size: 10px; color: #aaa">${card.effect}</div>
        </div>
      `,
          )
          .join('');
      }

      function drawCards(count) {
        for (let i = 0; i < count && state.hand.length < 5; i++) {
          const card = demoCards[Math.floor(Math.random() * demoCards.length)];
          state.hand.push({ ...card });
        }
        console.log(`[æŠ½ç‰Œ] +${count}å¼ `);
      }

      window.useCard = function (index) {
        if (state.cardsUsedThisTurn >= state.maxCardsPerTurn) {
          console.log('[é”™è¯¯] æœ¬å›åˆå·²æ— æ³•ä½¿ç”¨æ›´å¤šå¡ç‰Œ');
          return;
        }

        const card = state.hand[index];
        const cost = Math.abs(card.cost);

        // æ¶ˆè€—èµ„æº
        if (state.genki >= cost) {
          state.genki -= cost;
          console.log(`[æ¶ˆè€—] å…ƒæ°” -${cost}`);
        } else {
          const remaining = cost - state.genki;
          state.genki = 0;
          state.stamina -= remaining;
          console.log(`[æ¶ˆè€—] å…ƒæ°”æ¸…ç©º, ä½“åŠ› -${remaining}`);
        }

        console.log(`[ä½¿ç”¨] ${card.name}`);

        // æ‰§è¡Œæ•ˆæœ
        if (card.effect.includes('å¾—åˆ†')) {
          const match = card.effect.match(/\d+/);
          const score = match ? parseInt(match[0]) : 0;
          state.score += score;
          console.log(`  å¾—åˆ† +${score} â†’ ${state.score}`);
        }
        if (card.effect.includes('é›†ä¸­')) {
          const match = card.effect.match(/\d+/);
          const value = match ? parseInt(match[0]) : 0;
          state.concentration += value;
          console.log(`  é›†ä¸­ +${value} â†’ ${state.concentration}`);
        }
        if (card.effect.includes('å…ƒæ°”')) {
          const match = card.effect.match(/\d+/);
          const value = match ? parseInt(match[0]) : 0;
          state.genki = Math.min(100, state.genki + value);
          console.log(`  å…ƒæ°” +${value} â†’ ${state.genki}`);
        }
        if (card.effect.includes('å¥½å°è±¡')) {
          const match = card.effect.match(/\d+/);
          const value = match ? parseInt(match[0]) : 0;
          state.goodImpression += value;
          console.log(`  å¥½å°è±¡ +${value} â†’ ${state.goodImpression}`);
        }

        state.hand.splice(index, 1);
        state.cardsUsedThisTurn++;

        renderStats();
        renderHand();
      };

      window.skipTurn = function () {
        state.stamina = Math.min(state.maxStamina, state.stamina + 2);
        console.log(`[è·³è¿‡] ä½“åŠ› +2 â†’ ${state.stamina}`);
        endTurn();
      };

      window.endTurn = function () {
        console.log(`\n--- å›åˆ ${state.turn} ç»“æŸ ---`);

        // å¥½å°è±¡ç»“ç®—
        if (state.goodImpression > 0) {
          const bonus = state.goodImpression * 10;
          state.score += bonus;
          state.goodImpression = Math.max(0, state.goodImpression - 1);
          console.log(`[å¥½å°è±¡ç»“ç®—] +${bonus}åˆ†`);
        }

        state.turn++;
        state.cardsUsedThisTurn = 0;
        state.hand = [];

        if (state.turn > state.maxTurns) {
          console.log(`\n=== æˆ˜æ–—ç»“æŸ ===`);
          console.log(`æœ€ç»ˆå¾—åˆ†: ${state.score}/${state.targetScore}`);
          console.log(state.score >= state.targetScore ? 'âœ… CLEAR!' : 'âŒ FAIL...');
          return;
        }

        console.log(`\n=== å›åˆ ${state.turn} ===`);
        drawCards(3);
        renderStats();
        renderHand();
      };

      window.startBattle = function () {
        state = {
          turn: 1,
          maxTurns: 12,
          score: 0,
          targetScore: 100,
          genki: 0,
          stamina: 50,
          maxStamina: 50,
          concentration: 0,
          goodImpression: 0,
          cardsUsedThisTurn: 0,
          maxCardsPerTurn: 1,
          hand: [],
        };
        logEl.textContent = '';
        console.log('=== æˆ˜æ–—å¼€å§‹ ===');
        console.log(`ç›®æ ‡åˆ†æ•°: ${state.targetScore}`);
        drawCards(3);
        renderStats();
        renderHand();
      };

      // åˆå§‹åŒ–
      startBattle();
    </script>
  </body>
</html>
